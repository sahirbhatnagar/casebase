<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Population Time Plots • casebase</title>
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script><!-- Bootstrap --><link href="https://cdnjs.cloudflare.com/ajax/libs/bootswatch/3.4.0/cosmo/bootstrap.min.css" rel="stylesheet" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="../bootstrap-toc.css">
<script src="../bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="../pkgdown.css" rel="stylesheet">
<script src="../pkgdown.js"></script><meta property="og:title" content="Population Time Plots">
<meta property="og:description" content="casebase">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">
    

    <div class="container template-article">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="../index.html">casebase</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="Released version">0.10.4</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="../index.html">
    <span class="fas fa-home fa-lg"></span>
     
  </a>
</li>
<li class="dropdown">
  <a href="#" class="dropdown-toggle" data-toggle="dropdown" role="button" data-bs-toggle="dropdown" aria-expanded="false">
    Vignettes
     
    <span class="caret"></span>
  </a>
  <ul class="dropdown-menu" role="menu">
<li>
      <a href="../articles/popTime.html">Population Time Plots</a>
    </li>
    <li>
      <a href="../articles/smoothHazard.html">Fitting smooth-in-time parametric hazard functions</a>
    </li>
    <li>
      <a href="../articles/plotsmoothHazard.html">Plotting Hazards and Hazard Ratios</a>
    </li>
    <li>
      <a href="../articles/plotabsRisk.html">Plot Cumulative Incidence and Survival Curves</a>
    </li>
    <li>
      <a href="../articles/competingRisk.html">Competing risk analysis using case-base sampling</a>
    </li>
    <li>
      <a href="../articles/customizingpopTime.html">Customizing Population Time Plots</a>
    </li>
    <li>
      <a href="../articles/time-varying-covariates.html">Time-Varying Covariates</a>
    </li>
  </ul>
</li>
<li>
  <a href="../reference/index.html">Reference</a>
</li>
<li>
  <a href="../news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/sahirbhatnagar/casebase/" class="external-link">
    <span class="fab fa-github fa-lg"></span>
     
  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->

      

      </header><div class="row">
  <div class="col-md-9 contents">
    <div class="page-header toc-ignore">
      <h1 data-toc-skip>Population Time Plots</h1>
                        <h4 data-toc-skip class="author">Sahir R.
Bhatnagar</h4>
            
            <h4 data-toc-skip class="date">2024-04-09</h4>
      
      <small class="dont-index">Source: <a href="https://github.com/sahirbhatnagar/casebase/blob/HEAD/vignettes/popTime.Rmd" class="external-link"><code>vignettes/popTime.Rmd</code></a></small>
      <div class="hidden name"><code>popTime.Rmd</code></div>

    </div>

    
    
<div class="section level2">
<h2 id="overview">Overview<a class="anchor" aria-label="anchor" href="#overview"></a>
</h2>
<p>Population time plots can be extremely informative graphical displays
of survival data. They should be the first step in your exploratory data
analyses. We facilitate this task in the <code>casebase</code> package
by providing a <code>plot</code> method for objects returned by the
<code>popTime</code> function. This is done in two steps:</p>
<ol style="list-style-type: decimal">
<li>Pass your dataset to the <code><a href="../reference/popTime.html">casebase::popTime</a></code> function and
specify the column names corresponding to</li>
</ol>
<ul>
<li>the time of event</li>
<li>the event status</li>
<li>exposure (optional)</li>
</ul>
<p>This will create an object of class <code>popTime</code> with an
exposure attribute if you specify a value for the <code>exposure</code>
argument.</p>
<ol start="2" style="list-style-type: decimal">
<li>Pass the object of class <code>popTime</code> to the
<code>plot</code> function</li>
</ol>
<p>In this vignette we show how to create population-time plots for the
two datasets that ship with the <code>casebase</code> package, as well
as several well known survival datasets from the <code>survival</code>
package. For a more detailed description of how to modify the aesthetics
of a population time plot, please refer to the <a href="http://sahirbhatnagar.com/casebase/articles/customizingpopTime.html" class="external-link">Customizing
Population Time Plots</a> vignette.</p>
</div>
<div class="section level2">
<h2 id="load-required-packages">Load Required Packages<a class="anchor" aria-label="anchor" href="#load-required-packages"></a>
</h2>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://github.com/therneau/survival" class="external-link">survival</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://sahirbhatnagar.com/casebase/">casebase</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://ggplot2.tidyverse.org" class="external-link">ggplot2</a></span><span class="op">)</span></span>
<span><span class="kw"><a href="https://rdrr.io/r/base/library.html" class="external-link">library</a></span><span class="op">(</span><span class="va"><a href="https://r-datatable.com" class="external-link">data.table</a></span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="european-randomized-study-of-prostate-cancer-screening-data">European Randomized Study of Prostate Cancer Screening Data<a class="anchor" aria-label="anchor" href="#european-randomized-study-of-prostate-cancer-screening-data"></a>
</h2>
<p>For our first example, we make use of the European Randomized Study
of Prostate Cancer Screening (ERSPC) data which ships with the
<code>casebase</code> package (see
<code><a href="../reference/ERSPC.html">help("ERSPC", package = "casebase")</a></code> for details about this
data).</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"ERSPC"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">ERSPC</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##            ScrArm Follow.Up.Time DeadOfPrCa</span></span>
<span><span class="co">## 1 Screening group         0.0027          0</span></span>
<span><span class="co">## 2 Screening group         0.0027          0</span></span>
<span><span class="co">## 3 Screening group         0.0027          0</span></span>
<span><span class="co">## 4   Control group         0.0027          0</span></span>
<span><span class="co">## 5   Control group         0.0027          0</span></span>
<span><span class="co">## 6   Control group         0.0027          0</span></span></code></pre>
<p>We first pass this dataset to the <code>popTime</code> function. If
you do not specify the <code>time</code> and <code>event</code>
arguments, this function will try to guess them using regular
expressions. See the <strong>Details</strong> section of
<code><a href="../reference/popTime.html">help("popTime", package = "casebase")</a></code> for how we try to
guess these inputs.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">pt_object</span> <span class="op">&lt;-</span> <span class="fu">casebase</span><span class="fu">::</span><span class="fu"><a href="../reference/popTime.html">popTime</a></span><span class="op">(</span><span class="va">ERSPC</span>, event <span class="op">=</span> <span class="st">"DeadOfPrCa"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'Follow.Up.Time' will be used as the time variable</span></span></code></pre>
<p>We can see its contents and its class:</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pt_object</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##             ScrArm   time event original.time original.event event status</span></span>
<span><span class="co">##             &lt;fctr&gt;  &lt;num&gt; &lt;num&gt;         &lt;num&gt;          &lt;int&gt;       &lt;fctr&gt;</span></span>
<span><span class="co">## 1: Screening group 0.0027     0        0.0027              0     censored</span></span>
<span><span class="co">## 2: Screening group 0.0027     0        0.0027              0     censored</span></span>
<span><span class="co">## 3: Screening group 0.0027     0        0.0027              0     censored</span></span>
<span><span class="co">## 4:   Control group 0.0027     0        0.0027              0     censored</span></span>
<span><span class="co">## 5:   Control group 0.0027     0        0.0027              0     censored</span></span>
<span><span class="co">## 6:   Control group 0.0027     0        0.0027              0     censored</span></span>
<span><span class="co">##    ycoord    yc n_available</span></span>
<span><span class="co">##     &lt;int&gt; &lt;int&gt;       &lt;int&gt;</span></span>
<span><span class="co">## 1: 159893     0           0</span></span>
<span><span class="co">## 2: 159892     0           0</span></span>
<span><span class="co">## 3: 159891     0           0</span></span>
<span><span class="co">## 4: 159890     0           0</span></span>
<span><span class="co">## 5: 159889     0           0</span></span>
<span><span class="co">## 6: 159888     0           0</span></span></code></pre>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">pt_object</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "popTime"    "data.table" "data.frame"</span></span></code></pre>
<p>The <code>casebase</code> package has a <code>plot</code> method for
objects of class <code>popTime</code>:</p>
<div class="sourceCode" id="cb10"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot method for objects of class 'popTime'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pt_object</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-4-1.png" width="700"></p>
<p>One benefit from these plots is that it allows you to see the
incidence density. This can be seen from the distribution of the red
dots in the above plot. We can see that more events are observed later
on in time. Therefore a constant hazard model would not be appropriate
in this instance as it would overestimate the cumulative incidence
earlier on in time, and underestimate it later on.</p>
<p>The unique ‘step shape’ of the population time plot is due to the
randomization of the Finnish cohorts which were carried out on January 1
of each of the 4 years 1996 to 1999. This, coupled with the uniform
December 31 2006 censoring date, lead to large numbers of men with
exactly 11, 10, 9 or 8 years of follow-up.</p>
<p>It is important to note that the red points are random distributed
across the gray area for each time of event. That is, imagine we draw a
vertical line at a specific event time. We then plot the red point at a
randomly sampled y-coordinate along this vertical line. This is done to
avoid having all red points along the upper edge of the plot (because
the subjects with the least amount of observation time are plotted at
the top of the y-axis). By randomly distributing them, we can get a
better sense of the incidence density.</p>
<div class="section level3">
<h3 id="exposure-stratified-population-time-plot">Exposure Stratified Population Time Plot<a class="anchor" aria-label="anchor" href="#exposure-stratified-population-time-plot"></a>
</h3>
<p>Often the observations in a study are in specific groups such as
treatment arms. It may be of interest to compare the population time
plots between these two groups. Here we compare the control group and
the screening group. We create exposure stratified plots by specifying
the <code>exposure</code> argument in the <code>popTime</code>
function:</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stratified population time plot</span></span>
<span><span class="va">pt_object_strat</span> <span class="op">&lt;-</span> <span class="fu">casebase</span><span class="fu">::</span><span class="fu"><a href="../reference/popTime.html">popTime</a></span><span class="op">(</span><span class="va">ERSPC</span>, </span>
<span>                                     event <span class="op">=</span> <span class="st">"DeadOfPrCa"</span>, </span>
<span>                                     exposure <span class="op">=</span> <span class="st">"ScrArm"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'Follow.Up.Time' will be used as the time variable</span></span></code></pre>
<p>We can see its contents, class and that it has an exposure
attribute:</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/head.html" class="external-link">head</a></span><span class="op">(</span><span class="va">pt_object_strat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##           ScrArm   time event original.time original.event event status ycoord</span></span>
<span><span class="co">##           &lt;fctr&gt;  &lt;num&gt; &lt;num&gt;         &lt;num&gt;          &lt;int&gt;       &lt;fctr&gt;  &lt;int&gt;</span></span>
<span><span class="co">## 1: Control group 0.0027     0        0.0027              0     censored  88232</span></span>
<span><span class="co">## 2: Control group 0.0027     0        0.0027              0     censored  88231</span></span>
<span><span class="co">## 3: Control group 0.0027     0        0.0027              0     censored  88230</span></span>
<span><span class="co">## 4: Control group 0.0027     0        0.0027              0     censored  88229</span></span>
<span><span class="co">## 5: Control group 0.0137     0        0.0137              0     censored  88228</span></span>
<span><span class="co">## 6: Control group 0.0137     0        0.0137              0     censored  88227</span></span>
<span><span class="co">##       yc n_available</span></span>
<span><span class="co">##    &lt;int&gt;       &lt;int&gt;</span></span>
<span><span class="co">## 1:     0           0</span></span>
<span><span class="co">## 2:     0           0</span></span>
<span><span class="co">## 3:     0           0</span></span>
<span><span class="co">## 4:     0           0</span></span>
<span><span class="co">## 5:     0           0</span></span>
<span><span class="co">## 6:     0           0</span></span></code></pre>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">pt_object_strat</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "popTime"    "data.table" "data.frame"</span></span></code></pre>
<p>We can also see that the <code>pt_object_strat</code> has an exposure
attribute which contains the name of the exposure variable in the
dataset:</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">pt_object_strat</span>, <span class="st">"exposure"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "ScrArm"</span></span></code></pre>
<p>The plot method for objects of class <code>popTime</code> will use
this exposure attribute to create exposure stratified population time
plots:</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pt_object_strat</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-8-1.png" width="700"></p>
<p>We can also plot them side-by-side using the
<code>facet.params</code> argument, which is a list of arguments that
are passed to the <a href="https://ggplot2.tidyverse.org/reference/facet_wrap.html" class="external-link"><code>facet_wrap()</code></a>
function in the <code>ggplot2</code> package:</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pt_object_strat</span>,</span>
<span>     facet.params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-9-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="plotting-the-base-series">Plotting the base series<a class="anchor" aria-label="anchor" href="#plotting-the-base-series"></a>
</h3>
<p>To illustrate the casebase sampling methodology, we can also plot the
base series using the <code>add.base.series</code> function:</p>
<div class="sourceCode" id="cb21"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">pt_object_strat</span>,</span>
<span>     add.base.series <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-10-1.png" width="700"></p>
<p>Note that the <code>theme.params</code> argument is a list of
arguments passed to the <a href="https://ggplot2.tidyverse.org/reference/theme.html" class="external-link"><code>ggplot2::theme()</code></a>
function.</p>
</div>
</div>
<div class="section level2">
<h2 id="stem-cell-data">Stem Cell Data<a class="anchor" aria-label="anchor" href="#stem-cell-data"></a>
</h2>
<p>Next we show population time plots when there is a competing event.
The <code>bmtcrr</code> dataset contains information on patients who
underwent haematopoietic stem cell transplantation for acute leukaemia.
This data is included in the <code>casebase</code> package. See
<code><a href="../reference/bmtcrr.html">help("bmtcrr", package = "casebase")</a></code> for more details. We
will use this dataset to further illustrate the fundamental components
of a population time plot.</p>
<p>Note that for this dataset, the <code>popTime</code> fails to
identify a <code>time</code> variable if you didn’t specify one:</p>
<div class="sourceCode" id="cb22"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># load data</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="va">bmtcrr</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">bmtcrr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    177 obs. of  7 variables:</span></span>
<span><span class="co">##  $ Sex   : Factor w/ 2 levels "F","M": 2 1 2 1 1 2 2 1 2 1 ...</span></span>
<span><span class="co">##  $ D     : Factor w/ 2 levels "ALL","AML": 1 2 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ Phase : Factor w/ 4 levels "CR1","CR2","CR3",..: 4 2 3 2 2 4 1 1 1 4 ...</span></span>
<span><span class="co">##  $ Age   : int  48 23 7 26 36 17 7 17 26 8 ...</span></span>
<span><span class="co">##  $ Status: int  2 1 0 2 2 2 0 2 0 1 ...</span></span>
<span><span class="co">##  $ Source: Factor w/ 2 levels "BM+PB","PB": 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ ftime : num  0.67 9.5 131.77 24.03 1.47 ...</span></span></code></pre>
<div class="sourceCode" id="cb24"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># table of event status by exposure</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/table.html" class="external-link">table</a></span><span class="op">(</span><span class="va">bmtcrr</span><span class="op">$</span><span class="va">Status</span>, <span class="va">bmtcrr</span><span class="op">$</span><span class="va">D</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">##    </span></span>
<span><span class="co">##     ALL AML</span></span>
<span><span class="co">##   0  17  29</span></span>
<span><span class="co">##   1  28  28</span></span>
<span><span class="co">##   2  28  47</span></span></code></pre>
<div class="sourceCode" id="cb26"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># error because it can't determine a time variable</span></span>
<span><span class="va">popTimeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popTime.html">popTime</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bmtcrr</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Error in checkArgsTimeEvent(data = data, time = time, event = event): data does not contain time variable</span></span></code></pre>
<p>In this case, you must be explicit about what the time variable
is:</p>
<div class="sourceCode" id="cb28"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">popTimeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popTime.html">popTime</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bmtcrr</span>, time <span class="op">=</span> <span class="st">"ftime"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'Status' will be used as the event variable</span></span></code></pre>
<div class="sourceCode" id="cb30"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">popTimeData</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "popTime"    "data.table" "data.frame"</span></span></code></pre>
<div class="section level3">
<h3 id="plotting-the-follow-up-times-for-each-observation">Plotting the follow-up times for each observation<a class="anchor" aria-label="anchor" href="#plotting-the-follow-up-times-for-each-observation"></a>
</h3>
<p>We first plot that area on the graph representing the observed
follow-up time. Fundamentally, this area is constructed by plotting a
line for each individual, where the length of each line represents their
follow-up time in the cohort. The follow-up times are plotted from top
(shortest follow-up time) to bottom (longest follow-up time). In
practice, we instead plot a polygon using the <a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link"><code>ggplot2::geom_ribbon()</code></a>
function. The following figure shows this area for the
<code>bmtcrr</code> dataset. Note that we must specify
<code>add.case.series = FALSE</code> because the default is to add the
case series:</p>
<div class="sourceCode" id="cb32"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span>,</span>
<span>     add.case.series <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: No shared levels found between `names(values)` of the manual scale and the</span></span>
<span><span class="co">## data's <span style="color: #00BB00;">colour</span> values.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: No shared levels found between `names(values)` of the manual scale and the</span></span>
<span><span class="co">## data's <span style="color: #00BB00;">fill</span> values.</span></span></code></pre>
<p><img src="popTime_files/figure-html/unnamed-chunk-13-1.png" width="700"></p>
<p>Note that we can change the aesthetics of the area by using the
<code>ribbon.params()</code> argument as follows. These arguments are
passed to the <a href="https://ggplot2.tidyverse.org/reference/geom_ribbon.html" class="external-link"><code>ggplot2::geom_ribbon()</code></a>
function:</p>
<div class="sourceCode" id="cb35"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span>,</span>
<span>     add.case.series <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>     ribbon.params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>color <span class="op">=</span> <span class="st">"red"</span>, fill <span class="op">=</span> <span class="st">"blue"</span>, size <span class="op">=</span> <span class="fl">2</span>, alpha <span class="op">=</span> <span class="fl">0.2</span><span class="op">)</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning: No shared levels found between `names(values)` of the manual scale and the</span></span>
<span><span class="co">## data's <span style="color: #00BB00;">colour</span> values.</span></span></code></pre>
<pre><code><span><span class="co">## Warning: No shared levels found between `names(values)` of the manual scale and the</span></span>
<span><span class="co">## data's <span style="color: #00BB00;">fill</span> values.</span></span></code></pre>
<p><img src="popTime_files/figure-html/unnamed-chunk-14-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="plot-the-case-series">Plot the Case Series<a class="anchor" aria-label="anchor" href="#plot-the-case-series"></a>
</h3>
<p>Next we add the case series. Note that because the
<code>Status</code> column has a competing event (coded as 2), we must
specify <code>comprisk = TRUE</code> (even if you don’t want to plot the
competing event):</p>
<div class="sourceCode" id="cb38"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span>,</span>
<span>     add.case.series <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     comprisk <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-15-1.png" width="700"></p>
<p>In the above plot we can clearly see many of the deaths occur at the
beginning, so in this case, a constant hazard assumption isn’t valid.
This information is useful when deciding on the type of model to
use.</p>
</div>
<div class="section level3">
<h3 id="plot-the-base-series">Plot the Base Series<a class="anchor" aria-label="anchor" href="#plot-the-base-series"></a>
</h3>
<p>We can now add the base series with the <code>add.base.series</code>
argument. Internally, the <code>plot</code> method calls the
<code><a href="../reference/sampleCaseBase.html">casebase::sampleCaseBase</a></code> function to sample the base series
from the total person moments. This requires us to specify the ratio of
base series to case series in the <code>ratio</code> argument which we
will leave at its default of 1. A legend is also added by default:</p>
<div class="sourceCode" id="cb39"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span>,</span>
<span>     add.case.series <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     add.base.series <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     comprisk <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-16-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="plot-the-competing-event">Plot the Competing event<a class="anchor" aria-label="anchor" href="#plot-the-competing-event"></a>
</h3>
<p>We specify the <code>add.competing.event = TRUE</code> in order to
also plot the competing event. Note, that like the case series, the
competing event is sampled randomly on the vertical axis in order to see
the incidence density.</p>
<div class="sourceCode" id="cb40"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span>,</span>
<span>     add.case.series <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     add.base.series <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     add.competing.event <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     comprisk <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-17-1.png" width="700"></p>
<p>We can also only plot the case series and competing event (or any
combination):</p>
<div class="sourceCode" id="cb41"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span>,</span>
<span>     add.case.series <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     add.base.series <span class="op">=</span> <span class="cn">FALSE</span>,</span>
<span>     add.competing.event <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     comprisk <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-18-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="stratified-by-disease">Stratified by Disease<a class="anchor" aria-label="anchor" href="#stratified-by-disease"></a>
</h3>
<p>Next we stratify by disease; lymphoblastic or myeloblastic leukemia,
abbreviated as ALL and AML, respectively. We must specify the
<code>exposure</code> variable. Furthermore it is important to properly
label the factor variable corresponding to the exposure variable; this
will ensure proper labeling of the panels:</p>
<div class="sourceCode" id="cb42"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create 'popTime' object</span></span>
<span><span class="va">popTimeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popTime.html">popTime</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">bmtcrr</span>, time <span class="op">=</span> <span class="st">"ftime"</span>, exposure <span class="op">=</span> <span class="st">"D"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'Status' will be used as the event variable</span></span></code></pre>
<div class="sourceCode" id="cb44"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">popTimeData</span>, <span class="st">"exposure"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "D"</span></span></code></pre>
<div class="sourceCode" id="cb46"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span>,</span>
<span>     add.case.series <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     add.base.series <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     add.competing.event <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     comprisk <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-19-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="change-color-points-and-legend-labels">Change color points and legend labels<a class="anchor" aria-label="anchor" href="#change-color-points-and-legend-labels"></a>
</h3>
<p>Here is some code to change color points and legend labels. For a
more thorough description, please see the <a href="http://sahirbhatnagar.com/casebase/articles/customizingpopTime.html" class="external-link">Customizing
Population Time Plots</a> vignette.</p>
<div class="sourceCode" id="cb47"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span>,</span>
<span>     add.case.series <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     add.base.series <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     add.competing.event <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     comprisk <span class="op">=</span> <span class="cn">TRUE</span>,</span>
<span>     case.params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">yc</span>, colour <span class="op">=</span> <span class="st">"Relapse"</span>, fill <span class="op">=</span> <span class="st">"Relapse"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     base.params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">ycoord</span>, colour <span class="op">=</span> <span class="st">"Base series"</span>, fill <span class="op">=</span> <span class="st">"Base series"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     competing.params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>mapping <span class="op">=</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/aes.html" class="external-link">aes</a></span><span class="op">(</span>x <span class="op">=</span> <span class="va">time</span>, y <span class="op">=</span> <span class="va">yc</span>, colour <span class="op">=</span> <span class="st">"Competing event"</span>, fill <span class="op">=</span> <span class="st">"Competing event"</span><span class="op">)</span><span class="op">)</span>,</span>
<span>     fill.params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>name <span class="op">=</span> <span class="st">"Legend Name"</span>,</span>
<span>                        breaks <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Relapse"</span>, <span class="st">"Base series"</span>, <span class="st">"Competing event"</span><span class="op">)</span>,</span>
<span>                        values <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Relapse"</span> <span class="op">=</span> <span class="st">"blue"</span>, </span>
<span>                                   <span class="st">"Competing event"</span> <span class="op">=</span> <span class="st">"red"</span>, </span>
<span>                                   <span class="st">"Base series"</span> <span class="op">=</span> <span class="st">"orange"</span><span class="op">)</span><span class="op">)</span></span>
<span>     <span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in plot.popTime(popTimeData, add.case.series = TRUE, add.base.series =</span></span>
<span><span class="co">## TRUE, : fill.params has been specified by the user but color.params has not.</span></span>
<span><span class="co">## Setting color.params to be equal to fill.params.</span></span></code></pre>
<p><img src="popTime_files/figure-html/unnamed-chunk-20-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="veteran-data">Veteran Data<a class="anchor" aria-label="anchor" href="#veteran-data"></a>
</h2>
<p>Below are the steps to create a population time plot for the
Veterans’ Administration Lung Cancer study (see
<code><a href="https://rdrr.io/pkg/survival/man/veteran.html" class="external-link">help("veteran", package = "survival")</a></code> for more details on
this dataset).</p>
<div class="sourceCode" id="cb49"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># veteran data in library(survival)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"veteran"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## Warning in data("veteran"): data set 'veteran' not found</span></span></code></pre>
<div class="sourceCode" id="cb51"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">veteran</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    137 obs. of  8 variables:</span></span>
<span><span class="co">##  $ trt     : num  1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ celltype: Factor w/ 4 levels "squamous","smallcell",..: 1 1 1 1 1 1 1 1 1 1 ...</span></span>
<span><span class="co">##  $ time    : num  72 411 228 126 118 10 82 110 314 100 ...</span></span>
<span><span class="co">##  $ status  : num  1 1 1 1 1 1 1 1 1 0 ...</span></span>
<span><span class="co">##  $ karno   : num  60 70 60 60 70 20 40 80 50 70 ...</span></span>
<span><span class="co">##  $ diagtime: num  7 5 3 9 11 5 10 29 18 6 ...</span></span>
<span><span class="co">##  $ age     : num  69 64 38 63 65 49 69 68 43 70 ...</span></span>
<span><span class="co">##  $ prior   : num  0 10 0 10 10 0 10 0 0 0 ...</span></span></code></pre>
<div class="sourceCode" id="cb53"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">popTimeData</span> <span class="op">&lt;-</span> <span class="fu">casebase</span><span class="fu">::</span><span class="fu"><a href="../reference/popTime.html">popTime</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">veteran</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'time' will be used as the time variable</span></span></code></pre>
<pre><code><span><span class="co">## 'status' will be used as the event variable</span></span></code></pre>
<div class="sourceCode" id="cb56"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">popTimeData</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "popTime"    "data.table" "data.frame"</span></span></code></pre>
<div class="sourceCode" id="cb58"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-21-1.png" width="700"></p>
<p>We can see in this example that the dots are fairly evenly spread
out. That is, we don’t see any particular clusters of red dots
indicating that perhaps a constant hazard assumption would be
appropriate.</p>
<div class="section level3">
<h3 id="stratified-by-treatment-population-time-plot">Stratified by treatment population time plot<a class="anchor" aria-label="anchor" href="#stratified-by-treatment-population-time-plot"></a>
</h3>
<p>In this example we compare the standard and test treatment groups. A
reminder that this is done by simply specifying the
<code>exposure</code> argument in the <code><a href="../reference/popTime.html">casebase::popTime</a></code>
function:</p>
<div class="sourceCode" id="cb59"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># Label the factor so that it appears in the plot</span></span>
<span><span class="va">veteran</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">veteran</span>, trt <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">trt</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>                                           labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"standard"</span>, <span class="st">"test"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># create 'popTime' object</span></span>
<span><span class="va">popTimeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popTime.html">popTime</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">veteran</span>, exposure <span class="op">=</span> <span class="st">"trt"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'time' will be used as the time variable</span></span></code></pre>
<pre><code><span><span class="co">## 'status' will be used as the event variable</span></span></code></pre>
<div class="sourceCode" id="cb62"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># object of class 'popTime'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/class.html" class="external-link">class</a></span><span class="op">(</span><span class="va">popTimeData</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "popTime"    "data.table" "data.frame"</span></span></code></pre>
<div class="sourceCode" id="cb64"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># has name of exposure variable as an attribute</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/base/attr.html" class="external-link">attr</a></span><span class="op">(</span><span class="va">popTimeData</span>, <span class="st">"exposure"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## [1] "trt"</span></span></code></pre>
<p>Again, we simply pass this object to the <code>plot</code> function
to get an exposure stratified population time plot:</p>
<div class="sourceCode" id="cb66"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># plot method for objects of class 'popTime'</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-23-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="stanford-heart-transplant-data">Stanford Heart Transplant Data<a class="anchor" aria-label="anchor" href="#stanford-heart-transplant-data"></a>
</h2>
<p>Population time plots also allow you to explain patterns in the data.
We use the Stanford Heart Transplant Data to demonstrate this. See
<code><a href="https://rdrr.io/pkg/survival/man/heart.html" class="external-link">help("heart", package = "survival")</a></code> for details about this
dataset. For this example, we must create a time variable, because we
only have the start and stop times. This is a good example to show that
population time plots are also valid for this type of data
(i.e. subjects who have different entry times) because we are only
plotting the time spent in the study on the x-axis.</p>
<div class="sourceCode" id="cb67"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data from library(survival)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"heart"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">heart</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    172 obs. of  8 variables:</span></span>
<span><span class="co">##  $ start     : num  0 0 0 1 0 36 0 0 0 51 ...</span></span>
<span><span class="co">##  $ stop      : num  50 6 1 16 36 39 18 3 51 675 ...</span></span>
<span><span class="co">##  $ event     : num  1 1 0 1 0 1 1 1 0 1 ...</span></span>
<span><span class="co">##  $ age       : num  -17.16 3.84 6.3 6.3 -7.74 ...</span></span>
<span><span class="co">##  $ year      : num  0.123 0.255 0.266 0.266 0.49 ...</span></span>
<span><span class="co">##  $ surgery   : num  0 0 0 0 0 0 0 0 0 0 ...</span></span>
<span><span class="co">##  $ transplant: Factor w/ 2 levels "0","1": 1 1 1 2 1 2 1 1 1 2 ...</span></span>
<span><span class="co">##  $ id        : num  1 2 3 3 4 4 5 6 7 7 ...</span></span></code></pre>
<div class="sourceCode" id="cb69"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create time variable for time in study</span></span>
<span><span class="va">heart</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">heart</span>,</span>
<span>                   time <span class="op">=</span> <span class="va">stop</span> <span class="op">-</span> <span class="va">start</span>,</span>
<span>                   transplant <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">transplant</span>,</span>
<span>                                       labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"no transplant"</span>, <span class="st">"transplant"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># stratify by transplant indicator</span></span>
<span><span class="va">popTimeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popTime.html">popTime</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">heart</span>, exposure <span class="op">=</span> <span class="st">"transplant"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'time' will be used as the time variable</span></span></code></pre>
<pre><code><span><span class="co">## 'event' will be used as the event variable</span></span></code></pre>
<div class="sourceCode" id="cb72"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-24-1.png" width="700"></p>
<p>In the plot above we see that those who didn’t receive transplant
died very early (many red dots at the start of the x-axis). Those who
did receive the transplant have much better survival (as indicated by
the grey area). Does this show clear evidence that getting a heart
transplant increases survival? Not exactly. This is a classic case of
confounding by indication. In this study, the doctors only gave a
transplant to the healthier patients because they had a better chance of
surviving surgery.</p>
</div>
<div class="section level2">
<h2 id="ncctg-lung-cancer-data">NCCTG Lung Cancer Data<a class="anchor" aria-label="anchor" href="#ncctg-lung-cancer-data"></a>
</h2>
<p>The following example is from survival in patients with advanced lung
cancer from the North Central Cancer Treatment Group. See
<code><a href="https://rdrr.io/pkg/survival/man/lung.html" class="external-link">help("cancer", package = "survival")</a></code> for details about this
data.</p>
<div class="sourceCode" id="cb73"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># data from library(survival)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/data.html" class="external-link">data</a></span><span class="op">(</span><span class="st">"cancer"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/utils/str.html" class="external-link">str</a></span><span class="op">(</span><span class="va">cancer</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'data.frame':    228 obs. of  10 variables:</span></span>
<span><span class="co">##  $ inst     : num  3 3 3 5 1 12 7 11 1 7 ...</span></span>
<span><span class="co">##  $ time     : num  306 455 1010 210 883 ...</span></span>
<span><span class="co">##  $ status   : num  2 2 1 2 2 1 2 2 2 2 ...</span></span>
<span><span class="co">##  $ age      : num  74 68 56 57 60 74 68 71 53 61 ...</span></span>
<span><span class="co">##  $ sex      : num  1 1 1 1 1 1 2 2 1 1 ...</span></span>
<span><span class="co">##  $ ph.ecog  : num  1 0 0 1 0 1 2 2 1 2 ...</span></span>
<span><span class="co">##  $ ph.karno : num  90 90 90 90 100 50 70 60 70 70 ...</span></span>
<span><span class="co">##  $ pat.karno: num  100 90 90 60 90 80 60 80 80 70 ...</span></span>
<span><span class="co">##  $ meal.cal : num  1175 1225 NA 1150 NA ...</span></span>
<span><span class="co">##  $ wt.loss  : num  NA 15 15 11 0 0 10 1 16 34 ...</span></span></code></pre>
<div class="sourceCode" id="cb75"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># since the event indicator 'status' is numeric, it must have</span></span>
<span><span class="co"># 0 for censored and 1 for event</span></span>
<span><span class="va">cancer</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdrr.io/r/base/transform.html" class="external-link">transform</a></span><span class="op">(</span><span class="va">cancer</span>,</span>
<span>                    status <span class="op">=</span> <span class="va">status</span> <span class="op">-</span> <span class="fl">1</span>,</span>
<span>                    sex <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/factor.html" class="external-link">factor</a></span><span class="op">(</span><span class="va">sex</span>, levels <span class="op">=</span> <span class="fl">1</span><span class="op">:</span><span class="fl">2</span>,</span>
<span>                                 labels <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"Male"</span>, <span class="st">"Female"</span><span class="op">)</span><span class="op">)</span><span class="op">)</span></span>
<span></span>
<span><span class="va">popTimeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popTime.html">popTime</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cancer</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'time' will be used as the time variable</span></span></code></pre>
<pre><code><span><span class="co">## 'status' will be used as the event variable</span></span></code></pre>
<div class="sourceCode" id="cb78"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-25-1.png" width="700"></p>
<div class="section level3">
<h3 id="stratified-by-gender">Stratified by gender<a class="anchor" aria-label="anchor" href="#stratified-by-gender"></a>
</h3>
<p>We can also switch back to the default <code>ggplot2</code> theme by
specifying <code>casebase.theme = FALSE</code>:</p>
<div class="sourceCode" id="cb79"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">popTimeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popTime.html">popTime</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">cancer</span>, exposure <span class="op">=</span> <span class="st">"sex"</span><span class="op">)</span></span></code></pre></div>
<pre><code><span><span class="co">## 'time' will be used as the time variable</span></span></code></pre>
<pre><code><span><span class="co">## 'status' will be used as the event variable</span></span></code></pre>
<div class="sourceCode" id="cb82"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span>,</span>
<span>     casebase.theme <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-26-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="simulated-data-example">Simulated Data Example<a class="anchor" aria-label="anchor" href="#simulated-data-example"></a>
</h2>
<p>Below is an example based on simulated data.</p>
<div class="section level3">
<h3 id="simulate-the-data">Simulate the data<a class="anchor" aria-label="anchor" href="#simulate-the-data"></a>
</h3>
<div class="sourceCode" id="cb83"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/base/Random.html" class="external-link">set.seed</a></span><span class="op">(</span><span class="fl">1</span><span class="op">)</span></span>
<span><span class="va">nobs</span> <span class="op">&lt;-</span> <span class="fl">500</span></span>
<span></span>
<span><span class="co"># simulation parameters</span></span>
<span><span class="va">a1</span> <span class="op">&lt;-</span> <span class="fl">1.0</span></span>
<span><span class="va">b1</span> <span class="op">&lt;-</span> <span class="fl">200</span></span>
<span><span class="va">a2</span> <span class="op">&lt;-</span> <span class="fl">1.0</span></span>
<span><span class="va">b2</span> <span class="op">&lt;-</span> <span class="fl">50</span></span>
<span><span class="va">c1</span> <span class="op">&lt;-</span> <span class="fl">0.0</span></span>
<span><span class="va">c2</span> <span class="op">&lt;-</span> <span class="fl">0.0</span></span>
<span></span>
<span><span class="co"># end of study time</span></span>
<span><span class="va">eost</span> <span class="op">&lt;-</span> <span class="fl">10</span></span>
<span></span>
<span><span class="co"># e event type 0-censored, 1-event of interest, 2-competing event</span></span>
<span><span class="co"># t observed time/endpoint</span></span>
<span><span class="co"># z is a binary covariate</span></span>
<span><span class="va">DTsim</span> <span class="op">&lt;-</span> <span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/data.table.html" class="external-link">data.table</a></span><span class="op">(</span>ID <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/seq.html" class="external-link">seq_len</a></span><span class="op">(</span><span class="va">nobs</span><span class="op">)</span>, z<span class="op">=</span><span class="fu"><a href="https://rdrr.io/r/stats/Binomial.html" class="external-link">rbinom</a></span><span class="op">(</span><span class="va">nobs</span>, <span class="fl">1</span>, <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdatatable.gitlab.io/data.table/reference/setkey.html" class="external-link">setkey</a></span><span class="op">(</span><span class="va">DTsim</span>, <span class="va">ID</span><span class="op">)</span></span>
<span><span class="va">DTsim</span><span class="op">[</span>,<span class="fu">`:=`</span> <span class="op">(</span>event_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">rweibull</a></span><span class="op">(</span><span class="va">nobs</span>, <span class="va">a1</span>, <span class="va">b1</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">z</span> <span class="op">*</span> <span class="va">c1</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="va">a1</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             competing_time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/stats/Weibull.html" class="external-link">rweibull</a></span><span class="op">(</span><span class="va">nobs</span>, <span class="va">a2</span>, <span class="va">b2</span> <span class="op">*</span> <span class="fu"><a href="https://rdrr.io/r/base/Log.html" class="external-link">exp</a></span><span class="op">(</span><span class="va">z</span> <span class="op">*</span> <span class="va">c2</span><span class="op">)</span><span class="op">^</span><span class="op">(</span><span class="op">-</span><span class="fl">1</span><span class="op">/</span><span class="va">a2</span><span class="op">)</span><span class="op">)</span>,</span>
<span>             end_of_study_time <span class="op">=</span> <span class="va">eost</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">DTsim</span><span class="op">[</span>,<span class="fu">`:=`</span><span class="op">(</span>event <span class="op">=</span> <span class="fl">1</span> <span class="op">*</span> <span class="op">(</span><span class="va">event_time</span> <span class="op">&lt;</span> <span class="va">competing_time</span><span class="op">)</span> <span class="op">+</span></span>
<span>                <span class="fl">2</span> <span class="op">*</span> <span class="op">(</span><span class="va">event_time</span> <span class="op">&gt;=</span> <span class="va">competing_time</span><span class="op">)</span>,</span>
<span>            time <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/Extremes.html" class="external-link">pmin</a></span><span class="op">(</span><span class="va">event_time</span>, <span class="va">competing_time</span><span class="op">)</span><span class="op">)</span><span class="op">]</span></span>
<span><span class="va">DTsim</span><span class="op">[</span><span class="va">time</span> <span class="op">&gt;=</span> <span class="va">end_of_study_time</span>, <span class="va">event</span> <span class="op">:=</span> <span class="fl">0</span><span class="op">]</span></span>
<span><span class="va">DTsim</span><span class="op">[</span><span class="va">time</span> <span class="op">&gt;=</span> <span class="va">end_of_study_time</span>, <span class="va">time</span><span class="op">:=</span><span class="va">end_of_study_time</span><span class="op">]</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="population-time-plot">Population Time Plot<a class="anchor" aria-label="anchor" href="#population-time-plot"></a>
</h3>
<div class="sourceCode" id="cb84"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># create 'popTime' object</span></span>
<span><span class="va">popTimeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popTime.html">popTime</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTsim</span>, time <span class="op">=</span> <span class="st">"time"</span>, event <span class="op">=</span> <span class="st">"event"</span><span class="op">)</span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-28-1.png" width="700"></p>
</div>
<div class="section level3">
<h3 id="stratified-by-binary-covariate-z">Stratified by Binary Covariate z<a class="anchor" aria-label="anchor" href="#stratified-by-binary-covariate-z"></a>
</h3>
<div class="sourceCode" id="cb85"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="co"># stratified by binary covariate z</span></span>
<span><span class="va">popTimeData</span> <span class="op">&lt;-</span> <span class="fu"><a href="../reference/popTime.html">popTime</a></span><span class="op">(</span>data <span class="op">=</span> <span class="va">DTsim</span>, time <span class="op">=</span> <span class="st">"time"</span>, event <span class="op">=</span> <span class="st">"event"</span>, exposure <span class="op">=</span> <span class="st">"z"</span><span class="op">)</span></span>
<span></span>
<span><span class="co"># we can line up the plots side-by-side instead of one on top of the other</span></span>
<span><span class="co"># we can also change the theme by adding </span></span>
<span><span class="fu"><a href="https://rdrr.io/r/graphics/plot.default.html" class="external-link">plot</a></span><span class="op">(</span><span class="va">popTimeData</span>,</span>
<span>     facet.params <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ncol <span class="op">=</span> <span class="fl">2</span><span class="op">)</span><span class="op">)</span> <span class="op">+</span> <span class="fu"><a href="https://ggplot2.tidyverse.org/reference/ggtheme.html" class="external-link">theme_linedraw</a></span><span class="op">(</span><span class="op">)</span></span></code></pre></div>
<p><img src="popTime_files/figure-html/unnamed-chunk-29-1.png" width="700"></p>
</div>
</div>
<div class="section level2">
<h2 id="session-information">Session information<a class="anchor" aria-label="anchor" href="#session-information"></a>
</h2>
<pre><code><span><span class="co">## R version 4.3.3 (2024-02-29)</span></span>
<span><span class="co">## Platform: x86_64-pc-linux-gnu (64-bit)</span></span>
<span><span class="co">## Running under: Ubuntu 22.04.4 LTS</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## Matrix products: default</span></span>
<span><span class="co">## BLAS:   /usr/lib/x86_64-linux-gnu/openblas-pthread/libblas.so.3 </span></span>
<span><span class="co">## LAPACK: /usr/lib/x86_64-linux-gnu/openblas-pthread/libopenblasp-r0.3.20.so;  LAPACK version 3.10.0</span></span>
<span><span class="co">## </span></span>
<span><span class="co">## attached base packages:</span></span>
<span><span class="co">## [1] stats     graphics  grDevices utils     datasets  methods   base     </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## other attached packages:</span></span>
<span><span class="co">## [1] data.table_1.15.4 ggplot2_3.5.0     casebase_0.10.4   survival_3.5-8   </span></span>
<span><span class="co">## </span></span>
<span><span class="co">## loaded via a namespace (and not attached):</span></span>
<span><span class="co">##  [1] sass_0.4.9        utf8_1.2.4        generics_0.1.3    lattice_0.22-5   </span></span>
<span><span class="co">##  [5] digest_0.6.35     magrittr_2.0.3    evaluate_0.23     grid_4.3.3       </span></span>
<span><span class="co">##  [9] fastmap_1.1.1     jsonlite_1.8.8    Matrix_1.6-5      mgcv_1.9-1       </span></span>
<span><span class="co">## [13] purrr_1.0.2       fansi_1.0.6       scales_1.3.0      textshaping_0.3.7</span></span>
<span><span class="co">## [17] jquerylib_0.1.4   cli_3.6.2         rlang_1.1.3       munsell_0.5.1    </span></span>
<span><span class="co">## [21] splines_4.3.3     withr_3.0.0       cachem_1.0.8      yaml_2.3.8       </span></span>
<span><span class="co">## [25] tools_4.3.3       memoise_2.0.1     dplyr_1.1.4       colorspace_2.1-0 </span></span>
<span><span class="co">## [29] VGAM_1.1-10       vctrs_0.6.5       R6_2.5.1          stats4_4.3.3     </span></span>
<span><span class="co">## [33] lifecycle_1.0.4   fs_1.6.3          ragg_1.3.0        pkgconfig_2.0.3  </span></span>
<span><span class="co">## [37] desc_1.4.3        pkgdown_2.0.7     bslib_0.7.0       pillar_1.9.0     </span></span>
<span><span class="co">## [41] gtable_0.3.4      glue_1.7.0        systemfonts_1.0.6 xfun_0.43        </span></span>
<span><span class="co">## [45] tibble_3.2.1      tidyselect_1.2.1  highr_0.10        knitr_1.46       </span></span>
<span><span class="co">## [49] farver_2.1.1      htmltools_0.5.8.1 nlme_3.1-164      rmarkdown_2.26   </span></span>
<span><span class="co">## [53] labeling_0.4.3    compiler_4.3.3</span></span></code></pre>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">

        <nav id="toc" data-toggle="toc"><h2 data-toc-skip>Contents</h2>
    </nav>
</div>

</div>



      <footer><div class="copyright">
  <p></p>
<p>Developed by <a href="https://sahirbhatnagar.com/" class="external-link">Sahir Bhatnagar</a>, <a href="https://maxturgeon.ca/" class="external-link">Maxime Turgeon</a>, <a href="https://www.jesseislam.com/" class="external-link">Jesse Islam</a>, <a href="http://individual.utoronto.ca/osaarela/" class="external-link">Olli Saarela</a>, <a href="http://www.medicine.mcgill.ca/epidemiology/hanley/" class="external-link">James Hanley</a>.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.0.7.</p>
</div>

      </footer>
</div>

  


  

  </body>
</html>
